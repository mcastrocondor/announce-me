{"version":3,"file":"./app-announce/handler.js","mappings":"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","sources":["webpack://announce-me/./config/token.js","webpack://announce-me/./src/controllers/userController.js","webpack://announce-me/./src/index.js","webpack://announce-me/./src/middleware.js","webpack://announce-me/./src/models/mongodb/users.js","webpack://announce-me/./src/models/mongodb/validationLogin.js","webpack://announce-me/./src/models/mongodb/validationUser.js","webpack://announce-me/./src/repository/userRepository.js","webpack://announce-me/./src/service.js","webpack://announce-me/external commonjs \"@condor-labs/logger\"","webpack://announce-me/external commonjs \"bcrypt\"","webpack://announce-me/external commonjs \"config\"","webpack://announce-me/external commonjs \"dotenv\"","webpack://announce-me/external commonjs \"express\"","webpack://announce-me/external commonjs \"joi\"","webpack://announce-me/external commonjs \"jwt-simple\"","webpack://announce-me/external commonjs \"moment\"","webpack://announce-me/external commonjs \"mongoose\"","webpack://announce-me/external commonjs \"serverless-http\"","webpack://announce-me/webpack/bootstrap","webpack://announce-me/webpack/runtime/define property getters","webpack://announce-me/webpack/runtime/hasOwnProperty shorthand","webpack://announce-me/webpack/runtime/make namespace object","webpack://announce-me/./app-announce/handler.js"],"sourcesContent":["require('dotenv').config();\n\nmodule.exports = {\n    TOKEN_SECRET: process.env.TOKEN_SECRET || \"tokenultrasecreto\",\n  };","\nconst bcrypt = require('bcrypt');\nconst validateUser = require('../models/mongodb/validationUser');\nconst validateLogin = require('../models/mongodb/validationLogin');\nconst userRepository = require('../repository/userRepository');\nconst service = require('../service');\n\n\nexports.createUser = async function (req, res) {\n    try {\n        const validatedData = validateUser.validate({\n            name: req.body.name,\n            username: req.body.username,\n            password: req.body.password\n        });\n\n        if (!validatedData.error) {\n            username = req.body.username.toLowerCase();\n            const gotUser = await userRepository.getUser(username);\n\n            if (gotUser) {\n                return res.status(409).send({ msg: \"Username really exist\" });\n            } else {\n                passwordCrypt = bcrypt.hashSync(req.body.password, 10);\n                const user = {\n                    name: req.body.name,\n                    username: username,\n                    password: passwordCrypt\n                };\n                const newUser = await userRepository.saveUser(user);\n\n                return res.status(201).send({ createdUser: newUser, msg: \"Created User\" });\n            }\n        } else {\n\n            return res.status(400).send({ msg: \"error invalids data\" });\n        }\n    } catch (err) {\n        return res.status(500).send({ msg: err.message });\n    }\n};\n\nexports.authenticateUser = async function (req, res) {\n    try {\n        const validatedData = validateLogin.validate({\n            username: req.body.username,\n            password: req.body.password\n        });\n\n        if (!validatedData.error) {\n            const user = await userRepository.getUser(req.body.username.toLowerCase());\n            if (user) {\n                const match = await bcrypt.compare(req.body.password, user.password);\n                if (match) {\n                    return res.status(200).send({ token: service.createToken(user) });\n                } else {\n                    return res.status(404).send({ msg: \"Password is incorrect\" });\n                }\n            } else {\n                return res.status(404).send({ msg: \"User doesn't find, verify your data\" });\n            }\n\n        } else {\n            return res.status(400).send({ msg: \"error invalids data\" });\n        }\n\n    } catch (err) {\n        return res.status(500).send({ msg: err.message });\n    }\n};","\nrequire('dotenv').config();\nconst express = require('express');\nconst mongoose = require('mongoose');\nconst logger = require('@condor-labs/logger');\nconst config = require('config');\nconst app = express();\nconst db = config.get('mongoURI');\nconst port = process.env.PORT;\nconst userController = require('./controllers/userController');\nconst announceController = require('./controllers/announceController');\n\nconst middleware = require('./middleware');\n//const mongoHelper = require(\"./src/models/mongodb/mongoHelper\");\n\napp.use(express.json());\n\nmongoose\n  .connect(db, {})\n  .then(() => logger.log('MongoDB Connected...'))\n  .catch(err => logger.err(err));\n\napp.listen(port, () => {\n  logger.log(`Server started on port: http://localhost:${port}`);\n  // await  mongoHelper.connect();\n});\n\napp.post('/users', userController.createUser);\n\napp.post('/users/auth', userController.authenticateUser);\n\napp.post('/users/:id/announces', middleware.ensureAuthenticated, announceController.createAnnounce);\n\napp.get('/users/:id/announces', middleware.ensureAuthenticated, announceController.getAnnouncesbyUser);\n\napp.get('/users/announces/:id', middleware.ensureAuthenticated, announceController.getAnnouncebyId);\n\napp.delete('/users/:id/announces/:announceId', middleware.ensureAuthenticated, announceController.removeAnnounce);\n\napp.patch('/users/:id/announces/:announceId', middleware.ensureAuthenticated, announceController.updateAnnounce);\n\n\nmodule.exports = app;\n","var jwt = require(\"jwt-simple\");\nvar moment = require(\"moment\");\nvar config = require(\"../config/token\");\n\nexports.ensureAuthenticated = function (req, res, next) {\n  if (!req.headers.authorization) {\n    return res\n      .status(403)\n      .send({ message: \"Your request doesn't have authorization header\" });\n  }\n\n  const token = req.headers.authorization;\n  try {\n    const payload = jwt.decode(token, config.TOKEN_SECRET);\n   \n    if (payload.exp <= moment().unix()) {      \n      return res.status(401).send({ message: \"Token have expired\" });\n    }\n    req.user = payload.sub;\n    next();\n  } catch (err) {\n    return res.status(401).send({ message: err.message });\n  }\n\n};","//const mongoHelper = require(\"@condor-labs/mongodb\")();\n//const mongoose = mongoHelper.mongoose;\nconst mongoose = require('mongoose');\nconst Schema = mongoose.Schema;\n\nlet userSchema = new Schema({\n  name: { type: String, required: true },\n  username: { type: String, required: true, unique: true },\n  token: String,\n  password: { type: String, required: true }\n});\n\nlet userModel = mongoose.model(\"User\", userSchema);\n\nmodule.exports = userModel;","const Joi = require('joi');\n\nconst schemaLogin = Joi.object({\n    username: Joi.string()\n        .alphanum()\n        .min(3)\n        .max(60)\n        .required(),\n\n    password: Joi.string()\n        // .pattern(new RegExp('^(?=.*?[A-Z])(?=(.*[a-z]){1,})(?=(.*[\\d]){1,})(?=(.*[\\W]){1,})(?!.*\\s).{4,20}$'))\n        .min(3)\n        .max(20)\n        .required(),\n\n\n});\n\nmodule.exports = schemaLogin;","const Joi = require('joi');\n\nconst schemaUser = Joi.object({\n    name: Joi.string()\n        .min(3)\n        .max(60)\n        .required(),\n\n    username: Joi.string()\n        .alphanum()\n        .min(3)\n        .max(60)\n        .required(),\n\n    password: Joi.string()\n        //.pattern(new RegExp('^(?=.*?[A-Z])(?=(.*[a-z]){1,})(?=(.*[\\d]){1,})(?=(.*[\\W]){1,})(?!.*\\s).{4,20}$'))\n        .min(3)\n        .max(20)\n        .required(),\n\n    token: [\n        Joi.string(),\n        Joi.number()\n    ]\n\n});\n\nmodule.exports = schemaUser;","const User = require('../models/mongodb/users');\n\n\nexports.saveUser = async function (object) {\n    const newUser = new User({\n        name: object.name,\n        username: object.username,\n        password: object.password\n    });\n    const savedUser = await newUser.save();\n    const data = {\n        name: savedUser.name,\n        username: savedUser.username,\n        id: savedUser._id\n    };\n\n    return data;\n};\n\nexports.getUser = async function (username) {\n\n    const login = await User.findOne({ username: username });\n    return login;\n};\n\n","var jwt = require(\"jwt-simple\");\nvar moment = require(\"moment\");\nvar config = require(\"../config/token\");\n\nexports.createToken = function (user) {\n  var payload = {\n    sub: user._id,\n    iat: moment().unix(),\n    exp: moment().add(1, \"days\").unix(),\n  };\n  return jwt.encode(payload, config.TOKEN_SECRET);\n};","module.exports = require(\"@condor-labs/logger\");","module.exports = require(\"bcrypt\");","module.exports = require(\"config\");","module.exports = require(\"dotenv\");","module.exports = require(\"express\");","module.exports = require(\"joi\");","module.exports = require(\"jwt-simple\");","module.exports = require(\"moment\");","module.exports = require(\"mongoose\");","module.exports = require(\"serverless-http\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","'use strict';\nconst ServerlessHttp = require('serverless-http');\nconst app = require('../src/index');\n\nconst announceMe = ServerlessHttp(app);\n\n// const updateAnnounce = (event, context, callback) => {\n//   const data = JSON.parse(event.body);\n//   const id = event.pathParameters.id;\n//   return\n// };\n\nexport { announceMe };\n"],"names":["require","config","module","exports","TOKEN_SECRET","process","env","bcrypt","validateUser","validateLogin","userRepository","service","createUser","req","res","validatedData","validate","name","body","username","password","error","toLowerCase","gotUser","getUser","status","send","msg","passwordCrypt","hashSync","user","newUser","saveUser","createdUser","err","message","authenticateUser","match","compare","token","createToken","express","mongoose","logger","app","db","get","port","PORT","userController","announceController","middleware","use","json","connect","then","log","catch","listen","post","ensureAuthenticated","createAnnounce","getAnnouncesbyUser","getAnnouncebyId","delete","removeAnnounce","patch","updateAnnounce","jwt","moment","next","headers","authorization","payload","decode","exp","unix","sub","Schema","userSchema","type","String","required","unique","userModel","model","Joi","schemaLogin","object","string","alphanum","min","max","schemaUser","number","User","savedUser","save","data","id","_id","login","findOne","iat","add","encode","ServerlessHttp","announceMe"],"sourceRoot":""}